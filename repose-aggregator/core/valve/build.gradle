apply from: "$rootDir/gradle/baseProject.gradle"

apply plugin: 'application'
apply plugin: 'com.github.johnrengelman.shadow'

dependencies {
    compile "org.scala-lang:scala-library:$scalaVersion",
            "com.github.scopt:scopt_2.10:3.2.0",
            "com.typesafe:config:1.2.1",
            "org.springframework:spring-web:$springVersion",
            "org.springframework:spring-context:$springVersion",
            "org.springframework:spring-beans:$springVersion",
            "org.springframework:spring-core:$springVersion",
            "org.eclipse.jetty:jetty-server:$jettyVersion",
            "org.eclipse.jetty:jetty-servlet:$jettyVersion",
            "org.eclipse.jetty:jetty-util:$jettyVersion",
            "org.eclipse.jetty:jetty-webapp:$jettyVersion",
            project(":repose-aggregator:core:core-lib"),
            project(":repose-aggregator:core:core-service-api"),
            "com.typesafe.scala-logging:scala-logging-slf4j_2.10:$scalaLoggingVersion",
            "org.apache.logging.log4j:log4j-slf4j-impl:$log4jVersion",
            "org.apache.logging.log4j:log4j-core:$log4jVersion"

    testCompile "javax.servlet:javax.servlet-api:3.1.0",
            "org.scalatest:scalatest_2.10:$scalaTestVersion"
}

//For the ReplaceTokens ant filter
import org.apache.tools.ant.filters.ReplaceTokens

processResources {
    //Hack all the properties to a toString value, because I don't care!
    filter(ReplaceTokens, tokens: project.properties.collectEntries{ k,v -> [k.toString(), v.toString() ?: '']})
}

processTestResources {
    //Hack all the properties to a toString value, because I don't care!
    filter(ReplaceTokens, tokens: project.properties.collectEntries{ k,v -> [k.toString(), v.toString() ?: '']})
}

mainClassName = "org.openrepose.valve.Main"

shadowJar {
    //TODO: have to deal with the log4jPlugins.dat from the log4j-flume-ng dependency ?
    exclude "META-INF/*.SF"
    exclude "META-INF/*.DSA"
    exclude "META-INF/*.RSA"
}